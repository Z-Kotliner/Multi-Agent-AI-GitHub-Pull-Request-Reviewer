# Multi-Agent AI GitHub Pull Request Reviewer

This project builds a **multi-agent AI system** that integrates directly with the **GitHub API** to automatically review pull requests.  
It pulls **code diffs**, **test outcomes**, and **dependency data** to identify common issues such as:

- Lint violations  
- Missing tests  
- Vulnerability flags  

It then generates **short, human-like review comments** and posts them back to GitHub — allowing human reviewers to focus on deeper architectural and logic discussions.

---

## Core Idea

Instead of manually scanning every pull request for surface-level issues, this system acts as an **AI co-reviewer**.  
It leverages **LlamaIndex** to coordinate multiple intelligent agents that collaborate to fetch context, generate comments, and post them back to GitHub.

---

## System Architecture

The system is composed of **three AI agents** and one **workflow orchestrator**.

### 1. ContextAgent
**Purpose:** Gathers all contextual information about a pull request.

**Responsibilities:**
- Fetches PR data from GitHub using **PyGithub**.
- Collects:
  - Author, title, and body  
  - Diff URL and PR state  
  - Head SHA  
  - Changed files list  
- Passes all structured context to the **CommentorAgent**.

**Tools Used:**
- PR Info Tool  
- Commit Details Tool  
- File Fetching Tool  
- Context State Tool  

---

### 2. CommentorAgent
**Purpose:** Drafts high-quality, concise, and human-like review comments.

**Responsibilities:**
- Uses the PR context provided by `ContextAgent`.  
- Writes a review comment similar to what a human reviewer might produce.  
- Uses a **Groq LLM model** for natural comment generation.  
- Once finished, passes control to the **ReviewAndPostingAgent**.

**Tools Used:**
- Context Reader  
- Comment Generator (Groq-based)  
- State Updater  

---

### 3. ReviewAndPostingAgent
**Purpose:** Finalizes and posts the AI-generated review to GitHub.

**Responsibilities:**
- Reviews the comment generated by `CommentorAgent`.  
- Requests a rewrite if necessary (loops back to CommentorAgent).  
- Once satisfied, posts the review comment directly to GitHub using **PyGithub**.  
- Also uses a **Groq LLM model** to validate tone, clarity, and accuracy.

**Tools Used:**
- Comment Review Tool  
- GitHub Posting Tool  

---

### AgentWorkflow (Orchestrator)
**Purpose:** Manages all agent interactions, task routing, and event streaming.

**Responsibilities:**
- Initializes and sequences the three agents.  
- Manages handoffs between agents.  
- Streams all events to the console for visibility.  
- Ensures each PR review session runs to completion and posts automatically.

---

## Tooling Overview

| Tool | Description |
|------|--------------|
| **PR Info Tool** | Fetches pull request metadata such as author, title, and diff. |
| **Commit Details Tool** | Retrieves commit information for the PR. |
| **File Tool** | Fetches repository file contents for code inspection. |
| **Context State Tool** | Maintains agent states and context updates. |
| **GitHub Comment Posting Tool** | Posts the finalized comment to the pull request. |

---

## Tools & Frameworks Used

This project is built using a combination of **AI orchestration frameworks**, **developer utilities**, and **GitHub API clients**.

| Category | Technology | Purpose |
|-----------|-------------|----------|
| **AI Agent Framework** | [LlamaIndex](https://github.com/jerryjliu/llama_index) | Orchestrates multi-agent workflows and manages agent state. |
| **LLM Integration** | [Groq LLMs](https://groq.com/) | Provides fast, low-latency model inference for comment generation and validation. |
| **GitHub API Client** | [PyGithub](https://github.com/PyGithub/PyGithub) | Interfaces with GitHub’s API to fetch and post pull request data. |
| **Environment Management** | [python-dotenv](https://pypi.org/project/python-dotenv/) | Loads GitHub tokens and environment variables from `.env`. |
| **Core Python Libraries** | `os`, `json`, `requests`, etc. | Support utilities for I/O, configuration, and HTTP calls. |

---

## How to Run

### 1. Clone the repository
    
    ```bash
    git clone https://github.com/Z-Kotliner/multi-agent-pr-reviewer.git
    cd multi-agent-pr-reviewer
    
### 2. Install dependencies

    ```bash
    pip install -r requirements.txt 

### 3. Create a .env file in the project root:

    ```bash
    GITHUB_TOKEN=your_github_personal_access_token
    GITHUB_REPOSITORY=your_repo_name as “username/repo-name" e.g Z-Kotliner/recipe-api
    GROQ_API_KEY=your_groq_api_key
    
### 4. Run the main program

    ```bash
    python main.py

----

#### Usage

The program interacts via the command line.

You can issue natural language commands such as: "Write review for Pull request number 1."

The following example is for "https://github.com/Z-Kotliner/recipe-api/pull/1"

Example Console Session

    ```bash
    > python main.py
    Write review for Pull request number 1.
    Current agent: ReviewAndPostingAgent
    Selected tools:  ['handoff']
    Calling selected tool: handoff, with arguments: {'reason': 'To generate a review comment for Pull request number 1.', 'to_agent': 'CommentorAgent'}
    Output from tool: Agent CommentorAgent is now handling the request due to the following reason: To generate a review comment for Pull request number 1..
    Please continue with the current request.
    Current agent: CommentorAgent
    Selected tools:  ['handoff']
    Calling selected tool: handoff, with arguments: {'reason': 'Need PR details, changed files, and other repo files for a thorough review', 'to_agent': 'ContextAgent'}
    Output from tool: Agent ContextAgent is now handling the request due to the following reason: Need PR details, changed files, and other repo files for a thorough review.
    Please continue with the current request.
    Current agent: ContextAgent
    Selected tools:  ['get_pr_details']
    Calling selected tool: get_pr_details, with arguments: {'pr_number': 1}
    Output from tool: {'author': 'Z-Kotliner', 'title': 'Add RecipeRatings model and its corresponding serializer', 'body': 'This PR introduces a new RecipeRating model in models.py and its corresponding RecipeRatingSerializer in serializers.py.\r\nThese additions enable users to rate recipes and prepare the system for rating-related features.\r\n\r\n\r\nChanges Made:\r\n\r\n1. Added RecipeRating model (models.py)\r\n\r\n2. Added RecipeRatingSerializer (serializers.py)\r\n', 'diff_url': 'https://github.com/Z-Kotliner/recipe-api/pull/1.diff', 'state': 'open', 'commit_sha': ['4d10ff7e84a050998ca510b4c6dab74e126ba207']}
    Selected tools:  ['get_pr_commit_details']
    Calling selected tool: get_pr_commit_details, with arguments: {'commit_sha': '4d10ff7e84a050998ca510b4c6dab74e126ba207'}
    Output from tool: [{'filename': 'app/models.py', 'status': 'modified', 'additions': 18, 'deletions': 0, 'changes': 18, 'patch': '@@ -1,4 +1,5 @@\n from django.db import models\n+from django.conf import settings\n \n \n class Recipe(models.Model):\n@@ -9,3 +10,20 @@ class Recipe(models.Model):\n \n     def __str__(self):\n         return self.title\n+\n+\n+class RecipeRating(models.Model):\n+    recipe = models.ForeignKey(\n+        Recipe, on_delete=models.CASCADE, related_name="ratings"\n+    )\n+    user = models.ForeignKey(\n+        settings.AUTH_USER_MODEL, on_delete=models.CASCADE\n+    )\n+    stars = models.PositiveSmallIntegerField(\n+        choices=[(i, f"{i} star{\'s\' if i>1 else \'\'}") for i in range(1, 6)]\n+    )\n+    created_at = models.DateTimeField(auto_now_add=True)\n+\n+    class Meta:\n+        unique_together = ("recipe", "user")\n+        ordering = ["-created_at"]\n\\ No newline at end of file'}, {'filename': 'app/serializers.py', 'status': 'modified', 'additions': 12, 'deletions': 3, 'changes': 15, 'patch': '@@ -1,9 +1,18 @@\n from rest_framework import serializers\n-\n-from .models import Recipe\n-\n+from .models import Recipe, RecipeRating\n \n class RecipeSerializer(serializers.ModelSerializer):\n     class Meta:\n         model = Recipe\n         fields = ["id", "title", "description", "time_minutes", "price"]\n+\n+class RecipeRatingSerializer(serializers.ModelSerializer):\n+    class Meta:\n+        model = RecipeRating\n+        fields = ["id", "stars", "created_at"]\n+        read_only_fields = ["id", "created_at"]\n+\n+    def validate_stars(self, value):\n+        if not (1 <= value <= 5):\n+            raise serializers.ValidationError("Rating must be between 1 and 5.")\n+        return value\n\\ No newline at end of file'}]
    Selected tools:  ['get_file_contents']
    Calling selected tool: get_file_contents, with arguments: {'file_path': 'app/models.py'}
    Output from tool: from django.db import models
    
    
    class Recipe(models.Model):
        title = models.CharField(max_length=200)
        description = models.TextField(blank=True)
        time_minutes = models.IntegerField()
        price = models.DecimalField(max_digits=5, decimal_places=2)
    
        def __str__(self):
            return self.title
    
    Selected tools:  ['handoff']
    Calling selected tool: handoff, with arguments: {'reason': 'All context gathered for review of PR number 1', 'to_agent': 'CommentorAgent'}
    Output from tool: Agent CommentorAgent is now handling the request due to the following reason: All context gathered for review of PR number 1.
    Please continue with the current request.
    Current agent: CommentorAgent
    Selected tools:  ['add_comment_to_state']
    Calling selected tool: add_comment_to_state, with arguments: {'draft_comment': 'Thanks for adding the `RecipeRating` model and its corresponding serializer. The model seems well-structured, and the serializer is properly validated.\n\nOne potential improvement could be to add a `__str__` method to the `RecipeRating` model to provide a human-readable representation of the object.\n\nAdditionally, it might be helpful to include a docstring in the `RecipeRatingSerializer` to explain the purpose of the serializer and its fields.\n\nOverall, the code looks good, and with a few minor adjustments, it can be even more robust and maintainable.'}
    Output from tool: State updated with Thanks for adding the `RecipeRating` model and its corresponding serializer. The model seems well-structured, and the serializer is properly validated.
    
    One potential improvement could be to add a `__str__` method to the `RecipeRating` model to provide a human-readable representation of the object.
    
    Additionally, it might be helpful to include a docstring in the `RecipeRatingSerializer` to explain the purpose of the serializer and its fields.
    
    Overall, the code looks good, and with a few minor adjustments, it can be even more robust and maintainable. contexts. 
    Selected tools:  ['handoff']
    Calling selected tool: handoff, with arguments: {'reason': 'Draft review comment is ready for review and posting', 'to_agent': 'ReviewAndPostingAgent'}
    Output from tool: Agent ReviewAndPostingAgent is now handling the request due to the following reason: Draft review comment is ready for review and posting.
    Please continue with the current request.
    Current agent: ReviewAndPostingAgent
    Selected tools:  ['post_final_review_tool']
    Calling selected tool: post_final_review_tool, with arguments: {'comment_text': 'Thanks for adding the `RecipeRating` model and its corresponding serializer. The model seems well-structured, and the serializer is properly validated.\n\nOne potential improvement could be to add a `__str__` method to the `RecipeRating` model to provide a human-readable representation of the object.\n\nAdditionally, it might be helpful to include a docstring in the `RecipeRatingSerializer` to explain the purpose of the serializer and its fields.\n\nOverall, the code looks good, and with a few minor adjustments, it can be even more robust and maintainable.', 'pr_number': 1}
    Output from tool: PullRequestReview(user=NamedUser(login="Z-Kotliner"), id=3414665878)
    \n\nFinal response: The review comment has been posted to GitHub for Pull request number 1. 
    
    The review comment is: 
    Thanks for adding the `RecipeRating` model and its corresponding serializer. The model seems well-structured, and the serializer is properly validated.
    
    One potential improvement could be to add a `__str__` method to the `RecipeRating` model to provide a human-readable representation of the object.
    
    Additionally, it might be helpful to include a docstring in the `RecipeRatingSerializer` to explain the purpose of the serializer and its fields.
    
    Overall, the code looks good, and with a few minor adjustments, it can be even more robust and maintainable.



The review comment is automatically posted to the comments section of the pull request.

----

#### Further Improvement

In this project, you have to manually run the review agent when you suspect a new pull request has been created. 

To further automate PR review generation so that the agent runs automatically whenever a new pull request is created, use GitHub Actions Workflows. 

This is implemented in the https://github.com/Z-Kotliner/recipe-api repo. This project is integrated in the "agent.py" file.

It uses GitHub Workflows, adds .yml file instructions to add the following functionality

- Integrate automated testing and test coverage analysis.

- Run the review agent for automated PR review on events(on push, on new PR,on re-opened PR ...).

---

This project was done as part of fulfilment of the requirements of the 'Introduction to AI Engineering with Python' Hyperskill course.

### Learn more are:

https://hyperskill.org/projects/528


